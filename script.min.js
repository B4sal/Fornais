document.addEventListener("DOMContentLoaded",()=>{let e=document.getElementById("content"),t=document.getElementById("shop-date"),n=document.getElementById("countdown"),a=document.getElementById("br-shop-btn"),l=document.getElementById("news-events-btn"),r=document.getElementById("map-btn"),s=document.getElementById("search-bar"),i=document.getElementById("player-search-btn"),o=document.createElement("input"),d=document.getElementById("mission-stw-btn");o.id="player-id",o.placeholder="Ingresar el ID",o.type="text";let c=document.getElementById("suggestions-list"),p=[],m=()=>{function t(){let t=document.createElement("p");t.textContent="Imagen en proceso, int\xe9ntelo m\xe1s tarde.",t.style.textAlign="center",t.style.color="red",e.appendChild(t)}e.innerHTML="",fetch("https://worldtimeapi.org/api/timezone/Africa/Abidjan").then(e=>e.json()).then(n=>{let a=new Date(n.datetime),l=a.getUTCDate(),r=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],s=r[a.getUTCMonth()],i=a.getUTCFullYear(),o=`https://seebot.dev/images/archive/missions/${l}_${s}_${i}.png`,d=new Image;d.onload=function(){d.style.width="auto",d.style.height="auto",d.style.maxWidth="100%",d.style.display="block",d.style.margin="0 auto",d.style.border="none",e.appendChild(d)},d.onerror=function(){t()},d.src=o}).catch(e=>{console.error("Error al obtener la fecha y hora de Abidjan:",e),t()})};function u(){window.scrollTo({top:0,behavior:"smooth"})}d.addEventListener("click",m),window.onscroll=function(){let e=document.querySelector(".scroll-to-top");document.body.scrollTop>100||document.documentElement.scrollTop>100?e.style.display="block":e.style.display="none"};let h=()=>{let e=new Date,t=new Date;t.setHours(18,0,0,0),e>t&&t.setDate(t.getDate()+1);let a=t-e,l=Math.floor(a%864e5/36e5),r=Math.floor(a%36e5/6e4),s=Math.floor(a%6e4/1e3);n.textContent=`La tienda se actualizar\xe1 en ${l}h ${r}m ${s}s`,a<=0&&location.reload(),setTimeout(h,1e3)},$=async()=>{try{let n=await axios.get("https://fortnite-api.com/v2/shop"),a=n.data;if(200===a.status){let l=a.data.entries;p=l;let r=new Date(a.data.date).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"});t.textContent=`Fecha de la tienda: ${r}`,console.log(l),v(l),h()}else e.innerHTML="<p>Error al recuperar los datos de la tienda.</p>"}catch(s){console.error("Error fetching Fortnite shop:",s),e.innerHTML="<p>Error al recuperar los datos de la tienda.</p>"}},v=t=>{e.innerHTML="";let n={Outfit:"Skins",Emote:"Bailes",Wrap:"Envoltorios",Pickaxe:"Picos",Glider:"Alas Delta",Bundle:"Paquetes"},a={};t.forEach(e=>{let t=e.bundle?"Bundle":e.brItems&&e.brItems[0]?e.brItems[0].type.displayValue:"Unknown";if (!t) t = "Unknown"; a[t]||(a[t]=[]),a[t].push(e)}),Object.keys(a).forEach(t=>{if (t === "Unknown") return; let l=a[t],r=document.createElement("h2");r.className="type-header",r.textContent=n[t]||t,e.appendChild(r),l.forEach(t=>{let n=t.bundle?t.bundle.name:t.brItems&&t.brItems[0]?t.brItems[0].name:"Unknown",a=t.brItems&&t.brItems[0]?t.brItems[0].images.icon:"",l=t.finalPrice,r=t.brItems?t.brItems.map(e=>e.name).join(", "):"",s=t.brItems&&t.brItems[0]?`https://fortnite.gg/cosmetics?id=${t.brItems[0].id}`:"#",i=document.createElement("div");i.className="shop-item",i.innerHTML=`
                    <a href="${s}" target="_blank" class="shop-link">
                        <div class="shop-image">
                            <img src="${a}" alt="${n}">
                        </div>
                        <div class="shop-info">
                             <p class="item-name">${n}</p>
                                <div class="item-price">
                                    <img src="https://image.fnbr.co/price/icon_vbucks_50x.png" alt="V-Bucks Icon" class="vbucks-icon">
                                    <span>${l} V-Bucks</span>
                                </div>
                             <p class="loot-content">${r}</p>
                        </div>
                      </a>
                `,e.appendChild(i)})})},E=()=>{let e=s.value.toLowerCase(),t=p.filter(t=>{let n=t.bundle?t.bundle.name:t.brItems[0].name;return n.toLowerCase().includes(e)});v(t)},y=async()=>{let e=s.value.toLowerCase();if(c.innerHTML="",e.length<2){c.classList.remove("visible");return}let t=p.filter(t=>{let n=t.bundle?t.bundle.name:t.brItems[0].name;return n.toLowerCase().includes(e)});t.forEach(e=>{let t=e.bundle?e.bundle.name:e.brItems[0].name,n=document.createElement("li");n.textContent=t,n.className="suggestion-item",n.addEventListener("click",()=>{s.value=t,E(),c.classList.remove("visible")}),c.appendChild(n)}),c.classList.add("visible")};s.addEventListener("input",y),s.addEventListener("input",y);const showSuggestions = (value) => {
  let e = value.toLowerCase();
  if (e.length < 2) {
    c.classList.remove("visible");
    return;
  }
  let t = p.filter(t => {
    let n = t.bundle ? t.bundle.name : t.brItems[0].name;
    return n.toLowerCase().includes(e);
  });
  t.forEach(e => {
    let t = e.bundle ? e.bundle.name : e.brItems[0].name,
        n = document.createElement("li");
    n.textContent = t;
    n.className = "suggestion-item";
    n.addEventListener("click", () => {
      s.value = t;
      E();
      c.classList.remove("visible");
    });
    c.appendChild(n);
  });
  c.classList.add("visible");
};
s.addEventListener("input", () => showSuggestions(s.value));let g=async()=>{try{let t=await axios.get("https://fortnite-api.com/v2/news/br"),n=t.data;200===n.status?L(n.data):e.innerHTML="<p>Error al recuperar las noticias y eventos.</p>"}catch(a){console.error("Error fetching news and events:",a),e.innerHTML="<p>Error al recuperar las noticias y eventos.</p>"}},f=0,L=t=>{e.innerHTML="";let n=document.createElement("div");n.className="carousel";let a=document.createElement("div");a.className="slides",t.motds.forEach(e=>{let t=document.createElement("div");t.className="slide",t.style.backgroundImage=`url(${e.image})`;let n=document.createElement("div");n.className="info",n.innerHTML=`
                <h3>${e.title}</h3>
                <p>${e.body}</p>
            `,t.appendChild(n),a.appendChild(t)}),n.appendChild(a),e.appendChild(n);let l=document.createElement("button");l.className="nav-button prev",l.innerHTML="&#10094;",l.onclick=()=>b(f-1);let r=document.createElement("button");r.className="nav-button next",r.innerHTML="&#10095;",r.onclick=()=>b(f+1),n.appendChild(l),n.appendChild(r),b(f)};function b(e){let t=document.querySelector(".slides"),n=t.children.length;f=e>=n?0:e<0?n-1:e;let a=-(100*f);t.style.transform=`translateX(${a}%)`}function C(){b(f+1)}function k(){b(f-1)}let _=async()=>{try{let t=await axios.get("https://fortnite-api.com/v1/map"),n=t.data;200===n.status?w(n.data):e.innerHTML="<p>Error al recuperar el mapa.</p>"}catch(a){console.error("Error fetching map:",a),e.innerHTML="<p>Error al recuperar el mapa.</p>"}},w=t=>{e.innerHTML="";let n=document.createElement("div");n.className="map-container";let a=document.createElement("img");a.src=t.images.pois,a.alt="Mapa actual de Fortnite BR",n.appendChild(a),e.appendChild(n);let l=1,r=!1,s,i,o=e=>{r=!0,n.style.cursor="grabbing",s=e.clientX-a.offsetLeft,i=e.clientY-a.offsetTop,e.preventDefault()},d=()=>{r=!1,n.style.cursor="grab"},c=e=>{r&&(a.style.left=`${e.clientX-s}px`,a.style.top=`${e.clientY-i}px`,e.preventDefault())},p=e=>{e.preventDefault();let t=a.getBoundingClientRect(),n=e.clientX-t.left,r=e.clientY-t.top;l+=-.001*e.deltaY,l=Math.min(Math.max(.5,l),4),a.style.transformOrigin=`${n/t.width*100}% ${r/t.height*100}%`,a.style.transform=`scale(${l})`},m=e=>{e.preventDefault();let t=e.touches[0],n=e.touches[1];if(n){let r=Math.sqrt((t.clientX-n.clientX)**2+(t.clientY-n.clientY)**2);if(void 0!==u){let s=r/u;l=Math.min(Math.max(.5,l*s),4),a.style.transform=`scale(${l})`}u=r}},u;n.addEventListener("mousedown",o),n.addEventListener("mouseup",d),n.addEventListener("mouseleave",d),n.addEventListener("mousemove",c),n.addEventListener("wheel",p),n.addEventListener("touchstart",e=>{o(e.touches[0]),u=void 0}),n.addEventListener("touchend",d),n.addEventListener("touchmove",e=>{c(e.touches[0]),m(e)}),n.addEventListener("touchmove",e=>{e.preventDefault()})},T=()=>{e.innerHTML="";let t=document.createElement("div");t.className="player-search",t.appendChild(o);let n=document.createElement("button");n.textContent="Buscar Jugador",n.onclick=()=>{let e=o.value.trim();e&&M(e)},t.appendChild(n),e.appendChild(t)},M=t=>{let n=document.createElement("div");n.className="player-stats";let a=document.createElement("iframe");a.src=`https://fortnite.gg/reload-stats?player=${t}`,n.appendChild(a),e.appendChild(n)};a.addEventListener("click",$),l.addEventListener("click",g),r.addEventListener("click",_),s.addEventListener("input",E),i.addEventListener("click",T),$(),document.getElementById("scroll-to-top-btn").addEventListener("click",u),document.addEventListener("contextmenu",e=>e.preventDefault()),document.addEventListener("keydown",e=>{("F12"===e.key||e.ctrlKey&&e.shiftKey&&"I"===e.key)&&e.preventDefault()})});